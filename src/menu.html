<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Delivery Menu</title>

		<!-- bootstrap -->
		<link rel="stylesheet" href="vendor/bootstrap/css/bootstrap.min.css" />

		<!-- custom -->
		<link rel="stylesheet" href="css/style.css" />
	</head>

	<body>
		<!-- navbar section -->
		<nav class="navbar navbar-expand-lg bg-white">
			<div class="container py-2">
				<a class="navbar-brand" href="#">Delivery<span>Eats</span></a>
				<button
					class="navbar-toggler"
					type="button"
					data-bs-toggle="collapse"
					data-bs-target="#navbarSupportedContent"
					aria-controls="navbarSupportedContent"
					aria-expanded="false"
					aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarSupportedContent">
					<ul class="navbar-nav me-auto mb-2 mb-lg-0">
						<li class="nav-item"><a class="nav-link active" href="#">Menu</a></li>
						<li class="nav-item"><a class="nav-link" href="order.html">Orders</a></li>
						<li class="nav-item"><a class="nav-link" href="cart.html">Cart</a></li>
					</ul>
					<div class="d-flex align-items-center">
						<a class="nav-link me-3" href="profile.html" id="account">Account</a>
						<form id="logoutForm">
							<input type="hidden" name="token" value="" />
							<button type="submit" class="btn btn-deats btn-md">
								<span
									class="spinner-border spinner-border-sm me-2 d-none"
									role="status"
									aria-hidden="true"
									id="logoutSpinner">
								</span
								>Logout
							</button>
						</form>
					</div>
				</div>
			</div>
		</nav>

		<!-- menu section -->
		<section id="menu">
			<div class="container py-5">
				<div class="bg-deats rounded-3 p-5 shadow-sm">
					<!-- filter section -->
					<form action="" class="d-flex justify-content-between" id="filterForm">
						<div class="col-8 row">
							<div class="col-3 d-flex flex-column justify-content-between">
								<label for="category" class="form-label">Category</label>
								<select class="form-select" id="category">
									<option value="all">All</option>
									<option value="pizza">Pizza</option>
									<option value="burger">Burger</option>
									<option value="pasta">Pasta</option>
								</select>
							</div>

							<div class="col-3 d-flex flex-column justify-content-between">
								<label for="sort" class="form-label">Sort</label>
								<select class="form-select" id="sort">
									<option value="asc">Ascending</option>
									<option value="desc">Descending</option>
								</select>
							</div>

							<div class="col-6 d-flex flex-column justify-content-between">
								<label for="vegetarian" class="form-label">Option</label>
								<div class="form-check form-switch">
									<input
										class="form-check-input mb-2"
										type="checkbox"
										role="switch"
										id="vegetarian" />
									<label class="form-check-label" for="vegetarian">
										Show only vegetarian dishes
									</label>
								</div>
							</div>
						</div>
						<div class="d-flex align-items-end">
							<button type="submit" class="btn btn-deats btn-md">
								<span
									class="spinner-border spinner-border-sm me-2 d-none"
									role="status"
									aria-hidden="true"
									id="filterSpinner">
								</span>
								Filter
							</button>
						</div>
					</form>

					<!-- menu items -->
					<div class="mt-4 row row-cols-4 g-4" id="cardContainer"></div>

					<nav class="mt-4">
						<ul class="pagination">
							<li class="page-item"><a class="page-link" href="#">Previous</a></li>
							<li class="page-item"><a class="page-link" href="#">1</a></li>
							<li class="page-item"><a class="page-link" href="#">2</a></li>
							<li class="page-item"><a class="page-link" href="#">3</a></li>
							<li class="page-item"><a class="page-link" href="#">Next</a></li>
						</ul>
					</nav>

					<script>
						const cardContainer = document.getElementById('cardContainer');

						function createCard() {
							let card = document.createElement('div');
							card.classList.add('col');
							card.id = 'foodCard';

							card.innerHTML = `<div class="card rounded-3 overflow-hidden">
								<img
									src="../public/img/food.jpg"
									class="card-img-top object-fit-cover"
									alt="food image" />
								<div class="p-4">
									<h6>Card title</h6>
									<p class="category">Card title</p>
									<p>
										Some quick example text to build on the card title and make up the bulk of the
										card's content.
									</p>
									<div id="starContainer" value="4">

									</div>
								</div>
								<div class="card-footer bg-white d-flex justify-content-between align-items-center">
									<span>$20</span>
									<a href="#" class="btn btn-deats">Order</a>
								</div>
							</div>
							`;
							return card;
						}

						function createStar() {
							return `<svg
								xmlns="http://www.w3.org/2000/svg"
								enable-background="new 0 0 24 24"
								height="24px"
								viewBox="0 0 24 24"
								width="24px"
								fill="#000000"
								id="singleStar"
								class="active">
								<g>
									<path d="M0 0h24v24H0V0z" fill="none" />
									<path d="M0 0h24v24H0V0z" fill="none" />
								</g>
								<g>
									<path
										d="m12 17.27 4.15 2.51c.76.46 1.69-.22 1.49-1.08l-1.1-4.72 3.67-3.18c.67-.58.31-1.68-.57-1.75l-4.83-.41-1.89-4.46c-.34-.81-1.5-.81-1.84 0L9.19 8.63l-4.83.41c-.88.07-1.24 1.17-.57 1.75l3.67 3.18-1.1 4.72c-.2.86.73 1.54 1.49 1.08l4.15-2.5z" />
								</g>
							</svg>`;
						}

						let data = Array.from({ length: 3 }).map(() => {
							return createCard();
						});

						data.forEach((card) => {
							cardContainer.appendChild(card);
						});

						const filterForm = document.getElementById('filterForm');
						const filterButton = filterForm.querySelector('button');
						const filterSpinner = filterForm.querySelector('#filterSpinner');

						filterForm.addEventListener('submit', (e) => {
							filterButton.disabled = true;
							filterSpinner.classList.remove('d-none');

							e.preventDefault();

							let formData = {
								category: document.getElementById('category').value,
								sort: document.getElementById('sort').value,
								vegetarian: document.getElementById('vegetarian').checked,
							};

							console.log(formData);

							setTimeout(() => {
								data = Array.from({ length: Math.floor(Math.random() * 10) }).map(() => {
									return createCard();
								});

								cardContainer.innerHTML = '';
								data.forEach((card) => {
									cardContainer.appendChild(card);
								});

								filterButton.disabled = false;
								filterSpinner.classList.add('d-none');
							}, 2000);
						});
					</script>
				</div>
			</div>
		</section>

		<!-- toast -->
		<div class="toast-container position-fixed bottom-0 end-0 p-3">
			<div
				id="liveToast"
				class="toast align-items-center text-bg-deats border-0"
				role="alert"
				aria-live="assertive"
				aria-atomic="true">
				<div class="d-flex">
					<div class="toast-body"></div>
					<button
						type="button"
						class="btn-close btn-close-deats me-2 m-auto"
						data-bs-dismiss="toast"
						aria-label="Close"></button>
				</div>
			</div>
		</div>

		<!-- bootstrap -->
		<script type="text/javascript" src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

		<!-- script for login form -->
		<script>
			const bootstrap = window.bootstrap;

			const toast = document.getElementById('liveToast');
			const instance = bootstrap.Toast.getOrCreateInstance(toast);

			const logoutForm = document.getElementById('logoutForm');
			const logoutButton = logoutForm.querySelector('button');
			const logoutSpinner = logoutForm.querySelector('#logoutSpinner');

			logoutForm.addEventListener('submit', (e) => {
				logoutButton.disabled = true;
				logoutSpinner.classList.remove('d-none');

				e.preventDefault();
				const url = new URL('https://food-delivery.kreosoft.ru/api/account/logout');
				const token = localStorage.getItem('token');

				fetch(url, {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
						Authorization: `Bearer ${token}`,
					},
				})
					.then((response) => {
						if (response.status === 200) {
							localStorage.removeItem('token');
							window.location.href = 'login.html';
						} else {
							toast.querySelector('.toast-body').innerHTML = response.statusText;
							instance.show();
						}
					})
					.catch((error) => {
						toast.querySelector('.toast-body').innerHTML = error.message;
						instance.show();
						console.error(error);
					})
					.finally(() => {
						logoutButton.disabled = false;
						logoutSpinner.classList.add('d-none');
					});
			});
		</script>
	</body>
</html>
